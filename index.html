<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Dark POS - Android Fix</title>
<style>
:root{
  --bg:#0b0b0b;
  --card:#161616;
  --accent:#2979ff;
  --success:#2ecc71;
  --danger:#e74c3c;
  --text:#f2f2f2;
  --muted:#888;
}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);}
.hidden{display:none;}
.center{display:flex;align-items:center;justify-content:center;height:100vh;}
.card{background:var(--card);padding:20px;border-radius:14px;box-shadow:0 0 30px rgba(0,0,0,.7);}
input,button{width:100%;padding:16px;margin:6px 0;border-radius:10px;border:none;font-size:18px;text-align:center;}
input{background:#222;color:#fff;font-weight:bold;}
button{background:var(--accent);color:#fff;font-weight:600;cursor:pointer;-webkit-tap-highlight-color:transparent;}
button:hover{opacity:0.9;}
button.success{background:var(--success);}
button.danger{background:var(--danger);}
nav{position:fixed;bottom:0;width:100%;display:flex;background:#111;border-top:1px solid #222;}
nav button{flex:1;border-radius:0;background:#111;color:#aaa;padding:10px 0;font-size:14px;}
nav button.active{background:var(--accent);color:#fff;}
.section{padding:15px 15px 90px;}
.product{background:#1c1c1c;padding:15px;border-radius:12px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:1000;}
.modal-content{background:var(--card);padding:20px;border-radius:12px;min-width:280px;text-align:center;}
.modal-content input{margin-top:10px;padding:10px;font-size:16px;width:90%;}
.modal-content button{margin-top:15px;width:100%;padding:10px;font-size:16px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="center">
  <div class="card" style="width:300px;">
    <h2>üîê Wpisz PIN</h2>
    <input id="pinInput" type="tel" placeholder="PIN" inputmode="numeric" maxlength="4">
    <button id="loginBtn">Zaloguj</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <div id="sale" class="section"></div>
  <div id="orders" class="section hidden"></div>
  <div id="stock" class="section hidden"></div>
  <div id="clients" class="section hidden"></div>
  <div id="settings" class="section hidden"></div>
  <nav>
    <button data-section="sale" class="active">üßæ Sprzeda≈º</button>
    <button data-section="orders">üì¶ Zam√≥wienia</button>
    <button data-section="stock">üìä Magazyn</button>
    <button data-section="clients">üë• Klienci</button>
    <button data-section="settings">‚öôÔ∏è Ustawienia</button>
  </nav>
</div>

<!-- MODAL -->
<div id="modal" class="modal hidden">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
const PIN = "1312";
let state = {
  cash:false,
  products:[
    {id:1,name:"Produkt A",price:10,stock:5},
    {id:2,name:"Produkt B",price:20,stock:0},
    {id:3,name:"Produkt C",price:30,stock:10}
  ],
  cart:[],
  orders:[]
};

const loginDiv = document.getElementById("login");
const appDiv = document.getElementById("app");
const pinInput = document.getElementById("pinInput");
const loginBtn = document.getElementById("loginBtn");
const modal = document.getElementById("modal");
const modalContent = document.getElementById("modalContent");

// --- LOGIN ---
function login(){
  if(pinInput.value.trim()===PIN){
    loginDiv.classList.add("hidden");
    appDiv.classList.remove("hidden");
    renderSale();
  } else {
    pinInput.value="";
    pinInput.focus();
    showModal("Niepoprawny PIN");
  }
}
loginBtn.addEventListener("click", login);
pinInput.addEventListener("keyup",(e)=>{if(e.key==="Enter") login();});
window.onload = ()=>{pinInput.focus();};

// --- SHOW MODAL ---
function showModal(content, input=null, confirmCallback=null){
  modalContent.innerHTML="";
  if(typeof content==="string") modalContent.innerHTML=content;
  if(input) modalContent.appendChild(input);
  if(confirmCallback){
    let btn = document.createElement("button");
    btn.textContent="OK"; btn.className="success";
    btn.addEventListener("click", ()=>{
      confirmCallback();
      closeModal();
    });
    modalContent.appendChild(btn);
  } else {
    let btn = document.createElement("button");
    btn.textContent="OK"; btn.className="success";
    btn.addEventListener("click", closeModal);
    modalContent.appendChild(btn);
  }
  modal.classList.remove("hidden");
  if(input) setTimeout(()=>input.focus(),100);
}
function closeModal(){modal.classList.add("hidden");}

// --- ADD TO CART ---
function addToCart(p){
  if(p.stock<=0){
    // modal PIN dla brakujƒÖcego stanu
    let pinInputModal = document.createElement("input");
    pinInputModal.type="tel";
    pinInputModal.placeholder="Wpisz PIN aby sprzedaƒá brakujƒÖcy produkt";
    pinInputModal.inputMode="numeric";
    pinInputModal.maxLength=4;
    showModal(`<h3>Brak stanu produktu!</h3>`, pinInputModal, ()=>{
      if(pinInputModal.value===PIN){
        state.cart.push({...p});
        showModal(p.name+" dodano do koszyka");
      } else {
        showModal("Niepoprawny PIN, produkt nie zosta≈Ç dodany");
      }
    });
  } else {
    state.cart.push({...p});
    showModal(p.name+" dodano do koszyka");
  }
}

// --- RENDER SALE ---
function renderSale(){
  const saleDiv=document.getElementById("sale");
  saleDiv.innerHTML="<h2>Sprzeda≈º</h2>";
  state.products.forEach(p=>{
    let div=document.createElement("div");
    div.className="product";
    div.innerHTML=`<div>${p.name}<br>${p.price} PLN<br>Stan: ${p.stock}</div><button>Dodaj</button>`;
    div.querySelector("button").addEventListener("click",()=>addToCart(p));
    saleDiv.appendChild(div);
  });
  let payBtn=document.createElement("button");
  payBtn.textContent="Zap≈Çaƒá";
  payBtn.className="success";
  payBtn.addEventListener("click",checkout);
  saleDiv.appendChild(payBtn);
}

// --- CHECKOUT ---
function checkout(){
  if(state.cart.length===0){ showModal("Koszyk pusty"); return;}
  let total = state.cart.reduce((s,p)=>s+p.price,0);
  let paidInput = document.createElement("input");
  paidInput.type="number"; paidInput.placeholder="Kwota otrzymana";
  showModal(`<h3>Do zap≈Çaty: ${total} PLN</h3>`, paidInput, ()=>{
    let paid = parseFloat(paidInput.value);
    if(isNaN(paid)||paid<total){ showModal("Niepoprawna kwota"); return;}
    let change = paid-total;
    state.cart.forEach(c=>{
      let prod = state.products.find(p=>p.id===c.id);
      if(prod.stock>0) prod.stock--;
    });
    state.cart=[];
    renderSale();
    showModal(`<h3>Sprzeda≈º zako≈Ñczona</h3>Zap≈Çacono: ${paid} PLN<br>Reszta: ${change} PLN`);
  });
}

// --- NAVIGATION ---
document.querySelectorAll('nav button').forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll('.section').forEach(sec=>sec.classList.add('hidden'));
    document.getElementById(btn.dataset.section).classList.remove('hidden');
    document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  });
});
</script>

</body>
</html>
